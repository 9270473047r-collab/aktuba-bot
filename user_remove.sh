#!/bin/bash

# Проверка прав root
if [ "$(id -u)" != "0" ]; then
    echo "Запустите скрипт от имени root!"
    exit 1
fi

# Файл с данными пользователей (создайте заранее)
USER_DB="/etc/user_info.txt"

# Если файла нет - создаем шаблон
if [ ! -f "$USER_DB" ]; then
    echo "Файл $USER_DB не найден. Создаю шаблон..."
    echo "# Формат: Логин:ФИО:Должность" > "$USER_DB"
    echo "vasya:Василий Петров:Системный администратор" >> "$USER_DB"
    echo "petya:Петр Иванов:Разработчик" >> "$USER_DB"
    echo "Добавьте пользователей в этот файл!"
fi

# Вывод списка пользователей
echo "Список пользователей:"
awk -F: '{print NR, "- Логин:", $1, "| ФИО:", $2, "| Должность:", $3}' "$USER_DB"

# Запрос номера для удаления
echo -n "Введите номер пользователя для удаления: "
read num

# Получение логина по номеру
username=$(awk -F: -v line="$num" 'NR==line {print $1}' "$USER_DB")

if [ -z "$username" ]; then
    echo "Ошибка: неверный номер!"
    exit 1
fi

# Удаление пользователя
echo "Удаляем пользователя: $username"
userdel -r "$username" 2>/dev/null

# Проверка результата
if [ $? -eq 0 ]; then
    # Удаление из базы данных
    sed -i "${num}d" "$USER_DB"
    echo "Пользователь $username успешно удален!"
else
    echo "Ошибка удаления! Возможно пользователь не существует."
fi
